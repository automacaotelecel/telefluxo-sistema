generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String         @id @default(uuid())
  name          String
  email         String         @unique
  password      String
  role          String
  department    String
  isAdmin       Boolean        @default(false)
  status        String         @default("active")
  
  // HIERARQUIA
  managerId     String?
  manager       User?          @relation("ManagerToStaff", fields: [managerId], references: [id])
  staff         User[]         @relation("ManagerToStaff")

  agendaEvents  AgendaEvent[]
  notifications Notification[]
}

model Task {
  id        String    @id
  title     String
  user      String
  status    String
  priority  String
  deadline  String
  createdAt DateTime  @default(now())
  history   Comment[] // A relação chama "history", isso é importante
}

model Comment {
  id       Int     @id @default(autoincrement())
  text     String
  user     String
  date     String
  type     String  // 'comment', 'system' ou 'file'
  taskId   String
  task     Task    @relation(fields: [taskId], references: [id], onDelete: Cascade) 
  // Adicionei onDelete: Cascade para facilitar a exclusão
  fileUrl  String? 
  fileName String?
}

model AgendaEvent {
  id        String   @id @default(uuid()) // <--- ADICIONEI @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  title     String   
  date      String   
  completed Boolean  @default(false)
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  text      String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}